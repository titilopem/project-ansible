---
- name: Fetch and Deploy Artifacts into Tomcat on Nodes in group1
  hosts: group1
  become: true

  tasks:
    - name: Remove existing *.war files from webapps folder
      ansible.builtin.shell:
        cmd: "find /usr/local/bin/apache-tomcat-10.1.16/webapps/ -name '*.war' -type f -delete"
      ignore_errors: yes

    - name: Fetch .war files from n4c to local machine
      ansible.builtin.fetch:
        src: "{{ item.path }}"
        dest: "/tmp/"
        flat: yes
      with_items: "{{ warfile.files }}"
      delegate_to: n4c

    - name: Copy .war files to target hosts using SCP
      ansible.builtin.copy:
        src: "/tmp/{{ item.item.name }}"
        dest: "/usr/local/bin/apache-tomcat-10.1.16/webapps/"
      with_items: "{{ warfile.results }}"
...
